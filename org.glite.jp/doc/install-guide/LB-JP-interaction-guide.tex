\documentclass{egee}
\usepackage{comment,alltt}

\def\LB{L\&B}

\title{gLite Logging and Bookkeeping and Job Provenance Interaction Guide}
\author{CESNET EGEE JRA1 team}
\DocIdentifier{EGEE-JRA1-??}
\Date{\today}
\Activity{JRA1: Middleware Engineering and Integration}
\DocStatus{DRAFT}
\Dissemination{PUBLIC}
\DocumentLink{}
\Abstract{This guide is
  intended as a detailed technical guide to the Job Provenance (JP)
  deployment process.
  It is focused on  Logging and Bookkeeping (LB) interaction with JP.
  For description of deployment modules please refer to the "gLite
  install guide" document. 
}


\def\todo#1{\textbf{TODO:} #1}

\begin{document}


%\input{frontmatter}
%\newpage
%\tableofcontents
%\newpage

\section{Logging and Bookeeping (LB) and Job Provenance (JP)}
On fig.~\ref{fig:LB-JP-interactions} are depicted data flows between
LB and JP services. These flows are numbered and you can use this
numbers to find additional information about each flow in
table~\ref{tab:LB-JP-interactions}.

\begin{figure}[htpb]
  \centering
  \includegraphics[width=0.9\hsize]{LB-JP-interaction-details}
  \caption{LB to JP interactions detail overview}
  \label{fig:LB-JP-interactions}
\end{figure}

\begin{table}[htpb]
 \centering
  \begin{tabular}{|c|l|l|p{9cm}|}
    \hline
    &spool directory&initiated by&description\\
    \hline
    \hline
    1&lb.export.dump&lb-exporter&Export of LB job records into spool 
    directory. It use glite-lb-purge utility. LB-exporter reads this
    spool directory
    in a regular manner and implement next processing of LB dumps.\\
    \hline
    2&lb.export.jpreg&LB server&When new job come to the LB server 
    it stores its
    registration into the spool directory. It is responsibility of
    JP-importer process to handle such registrations.\\
    \hline
    3&lb.export.jpdump&lb-exporter&LB-exporter do its processing of 
    LB dumps and passes
    on it to the JP-importer using the spool directory.\\
    \hline
    4&none&jp-importer&JP importer handles registrations received from LB
    server and sends it to the JP primary server front-end (using its WS
    interface).\\
    \hline
    5&none&jp-importer&JP importer handles LB dumps received from LB
    exporter and sends it to the JP primary server back-end using its
    gridftp interface.\\
    \hline
  \end{tabular}
  \caption{LB to JP data flows description}
  \label{tab:LB-JP-interactions}
\end{table}


Notes:
\begin{itemize}
 \item Only JP Primary Storage (JPPS) server is involved in described
   data flows. JP Index Servers are not part of this picture (they are
   feeded via corresponding JPPS).
 \item Only flows number 4 and 5 are designed to be inter-host. All
   the other interactions assume the components are on the same host and
   do use access to a shared filesystem.
 \item Data flow number 1 use glite-lb-purge utility (see its
   documentation) and passes to it argument from lb.export.purgeargs
   clause of the deployment configuration file. This argument contain
   the timeouts controlling after how long period of time a job
   staying in a terminal state is to be purged from the LB server.
 \item The LB exporter have a feature to store LB job event dumps in a
   directory for further handling (e.g. for job statistic tool). This behaviour
   is controled by lb.export.jobs deployment config file clause (leave
   this clause empty if you don't use dumps for futher handling).
 \item The LB exporter also have a feature to keep all handled LB
   dumps (in glite-lb-purge format) in filesystem. This feature is
   controlled by lb.export.dump.keep.
 \item LB exporter is not a deamon, it's periodic invocation is
   provided by cron deamon.
\end{itemize}

\end{document}
